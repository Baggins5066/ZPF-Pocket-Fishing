<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zombie Fishing</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; background: #333; }
        body { width: 100vw; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        canvas { display: block; max-width: 100vw; max-height: 100vh; margin: auto; }
    #backpackBtn:hover #backpackIcon {
        transform: scale(1.18) rotate(-8deg);
        filter: drop-shadow(0 4px 16px #44f);
    }
    #backpackBtn:active #backpackIcon {
        transform: scale(0.92) rotate(8deg);
        filter: drop-shadow(0 2px 8px #222);
    }
    #backpackBtn:hover #backpackIcon {
        transform: scale(1.18) rotate(-8deg);
        filter: drop-shadow(0 4px 16px #44f);
    }
    #backpackBtn:active #backpackIcon {
        transform: scale(0.92) rotate(8deg);
        filter: drop-shadow(0 2px 8px #222);
    }
    </style>
</head>
<body>
<button id="backpackBtn" style="position:absolute;top:50%;left:10px;transform:translateY(-50%);z-index:11;width:56px;height:56px;padding:0;background:transparent;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
    <img src="assets/backpack.png" id="backpackIcon" alt="Backpack" style="width:48px;height:48px;transition:transform 0.18s cubic-bezier(.5,2,.5,1);filter:drop-shadow(0 2px 8px #222);">
</button>
<button id="castBtn" style="position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:10;font-size:24px;padding:10px 30px;">Cast</button>
<div id="inventoryModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.6);z-index:100;justify-content:center;align-items:center;">
  <div style="background:#222;padding:32px 40px;border-radius:16px;box-shadow:0 4px 32px #000;min-width:320px;max-width:90vw;">
    <h2 style="color:#fff;margin-top:0;margin-bottom:16px;">Inventory</h2>
    <pre id="modalInventoryText" style="color:#fff;font-size:18px;margin-bottom:24px;"></pre>
    <button id="closeInventoryBtn" style="font-size:20px;padding:8px 24px;background:#444;color:#fff;border-radius:8px;border:none;cursor:pointer;">Close</button>
  </div>
</div>
<script>
function getGameSize() {
    const w = window.innerWidth;
    const h = window.innerHeight;
    let width = w;
    let height = Math.round(w * 9 / 16);
    if (height > h) {
        height = h;
        width = Math.round(h * 16 / 9);
    }
    return { width, height };
}

let game;
let player, water, fishGroup, fishCount = 0, rodLevel = 1;
let fishText, upgradeText, statusText;
let isCasting = false;
let fishTypes = [
    { name: 'Bluegill', price: 1, weight: 7 },
    { name: 'Crappie', price: 2, weight: 5 },
    { name: 'Catfish', price: 2, weight: 5 },
    { name: 'Smallmouth bass', price: 5, weight: 2 },
    { name: 'Largemouth bass', price: 7, weight: 1 }
];
let inventory = {
    'Bluegill': 0,
    'Crappie': 0,
    'Catfish': 0,
    'Smallmouth bass': 0,
    'Largemouth bass': 0
};
let inventoryText;

function createGame() {
    const size = getGameSize();
    const config = {
        type: Phaser.AUTO,
        width: size.width,
        height: size.height,
        scene: {
            preload: preload,
            create: create,
            update: update
        },
        physics: {
            default: 'arcade',
            arcade: { gravity: { y: 0 } }
        }
    };
    game = new Phaser.Game(config);
}

window.addEventListener('resize', () => {
    if (game) {
        const size = getGameSize();
        game.scale.resize(size.width, size.height);
    }
});



document.getElementById('castBtn').addEventListener('click', () => {
    if (!isCasting) {
        castRod();
    }
});


// Ensure badge is created and initialized to 0 before game starts
function createInventoryBadge() {
    let badge = document.getElementById('inventoryBadge');
    if (!badge) {
        badge = document.createElement('span');
        badge.id = 'inventoryBadge';
        badge.style.position = 'absolute';
        badge.style.left = '38px';
        badge.style.top = '6px';
        badge.style.minWidth = '22px';
        badge.style.height = '22px';
        badge.style.background = '#44f';
        badge.style.color = '#fff';
        badge.style.fontSize = '16px';
        badge.style.fontWeight = 'bold';
        badge.style.borderRadius = '50%';
        badge.style.display = 'flex';
        badge.style.alignItems = 'center';
        badge.style.justifyContent = 'center';
        badge.style.boxShadow = '0 2px 8px #222';
        badge.style.zIndex = '12';
        badge.style.pointerEvents = 'none';
        badge.style.transition = 'transform 0.18s cubic-bezier(.5,2,.5,1)';
        badge.textContent = '0';
        document.getElementById('backpackBtn').appendChild(badge);
    }
}

createInventoryBadge();
createGame();

document.getElementById('backpackBtn').addEventListener('click', () => {
    updateModalInventoryText();
    document.getElementById('inventoryModal').style.display = 'flex';
    // Click animation: briefly scale down and up
    const icon = document.getElementById('backpackIcon');
    icon.style.transition = 'transform 0.12s cubic-bezier(.5,2,.5,1)';
    icon.style.transform = 'scale(0.92) rotate(8deg)';
    setTimeout(() => {
        icon.style.transition = 'transform 0.18s cubic-bezier(.5,2,.5,1)';
        icon.style.transform = '';
    }, 120);
});

document.getElementById('closeInventoryBtn').addEventListener('click', () => {
    document.getElementById('inventoryModal').style.display = 'none';
});

function updateModalInventoryText() {
    let totalValue = 0;
    let lines = [];
    for (let f of fishTypes) {
        let count = inventory[f.name];
        totalValue += count * f.price;
        lines.push(`${f.name}: ${count} ($${f.price} ea)`);
    }
    lines.push(`Total Value: $${totalValue}`);
    document.getElementById('modalInventoryText').textContent = lines.join('\n');
}

function preload() {
    this.load.image('player', 'https://via.placeholder.com/32x32.png?text=P');
    this.load.image('fish', 'assets/greenFish.png');
    this.load.image('water', 'https://via.placeholder.com/800x200.png?text=W');
}

function create() {
    water = this.physics.add.sprite(400, 500, 'water').setImmovable(true);
    player = this.physics.add.sprite(400, 200, 'player').setImmovable(true);
    fishGroup = this.physics.add.group();

    // Add labels next to sprites
    this.add.text(player.x + 40, player.y - 16, 'Fisher', { fontSize: '18px', color: '#fff' });
    this.add.text(water.x + 100, water.y - 20, 'Water', { fontSize: '18px', color: '#fff' });
    this.input.on('pointerdown', upgradeRod, this);
}

function spawnFish() {
    const x = Phaser.Math.Between(300, 500);
    const fish = fishGroup.create(x, 500, 'fish').setVelocityY(-50);
    fish.setData('value', 1);
}

function catchFish(player, fish) {
    fish.destroy();
    fishCount += fish.getData('value');
    fishText.setText(`Fish: ${fishCount}`);
    updateUpgradeText();
}

function upgradeRod() {
    // Removed rod upgrade functionality
}

function updateUpgradeText() {
    // Removed rod upgrade text
}

// --- Fishing Mechanic ---
function castRod() {
    isCasting = true;
    document.getElementById('castBtn').disabled = true;
    // Animate rod down (move player sprite)
    let scene = game.scene.scenes[0];
    scene.tweens.add({
        targets: player,
        y: 400,
        duration: 500,
        onComplete: () => {
            // Wait random 1-5 seconds
            let waitTime = Phaser.Math.Between(1000, 5000);
            setTimeout(() => {
                // Animate rod up
                scene.tweens.add({
                    targets: player,
                    y: 200,
                    duration: 500,
                    onComplete: () => {
                        // Enable cast button immediately after rod returns
                        document.getElementById('castBtn').disabled = false;
                        isCasting = false;
                        revealCatch(scene);
                    }
                });
            }, waitTime);
        }
    });
}

function revealCatch(scene) {
    // Weighted random fish selection
    let totalWeight = fishTypes.reduce((sum, f) => sum + f.weight, 0);
    let rand = Math.random() * totalWeight;
    let selectedFish = null;
    for (let f of fishTypes) {
        if (rand < f.weight) {
            selectedFish = f;
            break;
        }
        rand -= f.weight;
    }
    let caught = selectedFish !== null && Math.random() < 0.7; // 70% chance to catch something
    if (caught) {
        inventory[selectedFish.name]++;
        // Show fish sprite next to player with label
        let fishSprite = scene.add.sprite(player.x + 60, player.y + 32, 'fish');
        scene.add.text(player.x + 80, player.y + 16, selectedFish.name, { fontSize: '18px', color: '#fff' });
        setTimeout(() => fishSprite.destroy(), 1200);
    }
    updateInventoryText();
}

function updateInventoryText() {
    // Update inventory badge on backpack icon
    let totalCount = Object.values(inventory).reduce((a, b) => a + b, 0);
    let badge = document.getElementById('inventoryBadge');
    if (badge) {
        badge.textContent = totalCount;
    }
}

function update() {
    fishGroup.getChildren().forEach(fish => {
        if (fish.y < 300) fish.destroy();
    });
}
</script>
</body>
</html>