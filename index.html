<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zombie Fishing</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; background: #333; }
        body { width: 100vw; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        canvas { display: block; max-width: 100vw; max-height: 100vh; margin: auto; }
    </style>
</head>
<body>
<button id="castBtn" style="position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:10;font-size:24px;padding:10px 30px;">Cast</button>
<script>
function getGameSize() {
    const w = window.innerWidth;
    const h = window.innerHeight;
    let width = w;
    let height = Math.round(w * 9 / 16);
    if (height > h) {
        height = h;
        width = Math.round(h * 16 / 9);
    }
    return { width, height };
}

let game;
let player, water, fishGroup, fishCount = 0, rodLevel = 1;
let fishText, upgradeText, statusText;
let isCasting = false;
let fishTypes = [
    { name: 'Bluegill', price: 1, weight: 7 },
    { name: 'Crappie', price: 2, weight: 5 },
    { name: 'Catfish', price: 2, weight: 5 },
    { name: 'Smallmouth bass', price: 5, weight: 2 },
    { name: 'Largemouth bass', price: 7, weight: 1 }
];
let inventory = {
    'Bluegill': 0,
    'Crappie': 0,
    'Catfish': 0,
    'Smallmouth bass': 0,
    'Largemouth bass': 0
};
let inventoryText;

function createGame() {
    const size = getGameSize();
    const config = {
        type: Phaser.AUTO,
        width: size.width,
        height: size.height,
        scene: {
            preload: preload,
            create: create,
            update: update
        },
        physics: {
            default: 'arcade',
            arcade: { gravity: { y: 0 } }
        }
    };
    game = new Phaser.Game(config);
}

window.addEventListener('resize', () => {
    if (game) {
        const size = getGameSize();
        game.scale.resize(size.width, size.height);
    }
});


createGame();
document.getElementById('castBtn').addEventListener('click', () => {
    if (!isCasting) {
        castRod();
    }
});

function preload() {
    this.load.image('player', 'https://via.placeholder.com/32x32.png?text=P');
    this.load.image('fish', 'https://via.placeholder.com/16x16.png?text=F');
    this.load.image('water', 'https://via.placeholder.com/800x200.png?text=W');
}

function create() {
    water = this.physics.add.sprite(400, 500, 'water').setImmovable(true);
    player = this.physics.add.sprite(400, 200, 'player').setImmovable(true);
    fishGroup = this.physics.add.group();

    fishText = this.add.text(16, 16, 'Fish: 0', { fontSize: '20px', color: '#fff' });
    upgradeText = this.add.text(16, 40, 'Rod Level: 1 (Cost: 10 fish)', { fontSize: '20px', color: '#fff' });
    statusText = this.add.text(16, 64, 'Status: Ready to cast!', { fontSize: '20px', color: '#fff' });
    inventoryText = this.add.text(16, 88, 'Inventory:', { fontSize: '20px', color: '#fff' });

    updateInventoryText();

    // Add labels next to sprites
    this.add.text(player.x + 40, player.y - 16, 'Fisher', { fontSize: '18px', color: '#fff' });
    this.add.text(water.x + 100, water.y - 20, 'Water', { fontSize: '18px', color: '#fff' });
    this.input.on('pointerdown', upgradeRod, this);
}

function spawnFish() {
    const x = Phaser.Math.Between(300, 500);
    const fish = fishGroup.create(x, 500, 'fish').setVelocityY(-50);
    fish.setData('value', 1);
}

function catchFish(player, fish) {
    fish.destroy();
    fishCount += fish.getData('value');
    fishText.setText(`Fish: ${fishCount}`);
    updateUpgradeText();
}

function upgradeRod() {
    const cost = rodLevel * 10;
    if (fishCount >= cost) {
        fishCount -= cost;
        rodLevel++;
        fishText.setText(`Fish: ${fishCount}`);
        updateUpgradeText();
        statusText.setText('Status: Rod upgraded!');
        this.time.delayedCall(2000, () => statusText.setText('Status: Fishing...'));
    }
}

function updateUpgradeText() {
    upgradeText.setText(`Rod Level: ${rodLevel} (Cost: ${rodLevel * 10} fish)`);

}

// --- Fishing Mechanic ---
function castRod() {
    isCasting = true;
    statusText.setText('Status: Casting...');
    document.getElementById('castBtn').disabled = true;
    // Animate rod down (move player sprite)
    let scene = game.scene.scenes[0];
    scene.tweens.add({
        targets: player,
        y: 400,
        duration: 500,
        onComplete: () => {
            // Wait random 1-5 seconds
            let waitTime = Phaser.Math.Between(1000, 5000);
            statusText.setText('Status: Waiting for a bite...');
            setTimeout(() => {
                // Animate rod up
                scene.tweens.add({
                    targets: player,
                    y: 200,
                    duration: 500,
                    onComplete: () => {
                        revealCatch(scene);
                    }
                });
            }, waitTime);
        }
    });
}

function revealCatch(scene) {
    // Weighted random fish selection
    let totalWeight = fishTypes.reduce((sum, f) => sum + f.weight, 0);
    let rand = Math.random() * totalWeight;
    let selectedFish = null;
    for (let f of fishTypes) {
        if (rand < f.weight) {
            selectedFish = f;
            break;
        }
        rand -= f.weight;
    }
    let caught = selectedFish !== null && Math.random() < 0.7; // 70% chance to catch something
    if (caught) {
        inventory[selectedFish.name]++;
        fishText.setText(`Fish: ${Object.values(inventory).reduce((a,b)=>a+b,0)}`);
        statusText.setText(`Status: You caught a ${selectedFish.name}! ($${selectedFish.price})`);
        // Show fish sprite next to player with label
        let fishSprite = scene.add.sprite(player.x + 60, player.y + 32, 'fish');
        scene.add.text(player.x + 80, player.y + 16, selectedFish.name, { fontSize: '18px', color: '#fff' });
        setTimeout(() => fishSprite.destroy(), 1200);
    } else {
        statusText.setText('Status: Nothing was caught.');
    }
    updateInventoryText();
    updateUpgradeText();
    setTimeout(() => {
        statusText.setText('Status: Ready to cast!');
        isCasting = false;
        document.getElementById('castBtn').disabled = false;
    }, 1500);
}

function updateInventoryText() {
    let totalValue = 0;
    let lines = ['Inventory:'];
    for (let f of fishTypes) {
        let count = inventory[f.name];
        totalValue += count * f.price;
        lines.push(`${f.name}: ${count} ($${f.price} ea)`);
    }
    lines.push(`Total Value: $${totalValue}`);
    inventoryText.setText(lines.join('\n'));
}

function update() {
    fishGroup.getChildren().forEach(fish => {
        if (fish.y < 300) fish.destroy();
    });
}
</script>
</body>
</html>